/*1338773350,176820663*/

if (window.CavalryLogger) { CavalryLogger.start_js(["bZwa+"]); }

window.__UIControllerRegistry=window.__UIControllerRegistry||{};
__d("FeedTrackingAsync",["event-extensions","collectDataAttributes","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('collectDataAttributes'),h=b('copyProperties');function i(j){Event.listen(j,'AsyncRequest/send',function(event){var k=event.getTarget(),l=event.getData().request,m=l.getData(),n=g(k,['ft']);h(m,n);});}e.exports={init:i};});
__d("legacy:LayerFadeOnHide",["LayerFadeOnHide"],function(a,b,c,d){a.LayerFadeOnHide=b('LayerFadeOnHide');},3);
__d("legacy:ufi-optimistic",["OptimisticUFI"],function(a,b,c,d){a.UFIOptimistic=b('OptimisticUFI');},3);
function TickerController(){}!function(){var a=1,b=2,c=3,d=4;copy_properties(TickerController,{_instances:{},_activeInstance:null,_placeholders:{},_logPositionChange:false,getInstance:function(e){var f=Parent.byClass($(e),'fbFeedTicker');return f?TickerController._instances[f.id]:null;},isLoaded:function(e){var f=TickerController._placeholders[e.id];return !f||f.status==c;},show:function(e,f){f=f||bagofholding;for(var g in TickerController._instances){var h=ge(g);if(!h||h.parentNode.id==e.id)continue;TickerController.hide(h.parentNode);}TickerController._doPositionChange(e);CSS.show(e);var i=TickerController._placeholders[e.id];if(i&&i.status==a){TickerController._fetchTickerForPlaceholder(e,f);}else{var j=DOM.scry(e,'.fbFeedTicker')[0],k=j&&TickerController.getInstance(j);TickerController._activeInstance=k;k&&k._poll();TickerController._placeholders[e.id]={status:d,callback:f};f();}},_doPositionChange:function(e){if(!TickerController._logPositionChange||CSS.shown(e))return;new AsyncSignal('/common/ods_endpoint.php',{k:'ticker.render.switch.'+e.id}).send();},hide:function(e){var f=DOM.scry(e,'.fbFeedTicker')[0],g=f&&TickerController.getInstance(f);g&&g.hideActiveStory();CSS.hide(e);},hideStoriesByClass:function(e){for(var f in TickerController._instances)DOM.scry($(f),e).forEach(CSS.hide);},hideStory:function(e){var f=e&&TickerController.getInstance(e);f&&f.hideStory(e);},undoHideStory:function(e){var f=e&&TickerController.getInstance(e);f&&f.undoHideStory(e);},_fetchTickerForPlaceholder:function(e,f){var g={handler:function(){TickerController._placeholders[e.id].status=c;f();}};UIPagelet.loadFromEndpoint('TickerPagelet',e.id,TickerController._placeholders[e.id].pageletData,g);TickerController._placeholders[e.id].status=b;},registerStoryDialog:function(e,f){Arbiter.subscribe('ticker/init',function(){var g=ge(e),h=g&&TickerController.getInstance(g);h&&h.registerStoryDialog(g,f);},Arbiter.SUBSCRIBE_ALL);},registerPlaceholder:function(e,f){var g=TickerController._placeholders[e];TickerController._placeholders[e]={status:a,pageletData:f};if(g&&g.status==d){TickerController.show($(e));g.callback();}}});}();copy_properties(TickerController.prototype,{ADS_IDLE_MS:300000,FLYOUT_MAX_HEIGHT:450,FLYOUT_OFFSET_THRESHOLD:20,FLYOUT_COMMENT_OFFSET:15,FLYOUT_VIEWPORT_PADDING:75,FLYOUT_TARGET_HEIGHT_OFFSET:25,init:function(a,b,c){TickerController._instances[a.id]=this;TickerController._activeInstance=this;this._root=a;this._content=DOM.find(a,'.ticker_stream');this._stories=DOM.find(this._root,'.tickerActivityStories');this._scrollableArea=b;this._container=DOM.find(a,'div.uiScrollableAreaWrap');this._newestStory={};this._storyIDs=[];this._objectIDs=[];this._fetchedStories={};this._removedStoryIDs=[];this._storiesToRemove=[];var d=Date.now();this._initTime=d;this._lastUpdate=d;this._lastPull=d;this._lastInsert=d;this._lastCustomStory=0;this._pollOnly=false;this._needNonCustomStoryNum=0;this._doCustomUpdate=true;this._autoloadStoryIndex=1;this._scrollTopThreshold=100;this._scrollTopPrompt=DOM.find(this._root,'.scrollTopPrompt');this._scrollTopPromptVisible=false;this._maxStoriesToKeep=50;this._minStoriesToKeep=25;this._tickerInSidebarMode=!!Parent.byClass(this._root,'fbChatSidebar');this._loadStoriesWithActions();this._ua={flyout:user_action('ticker_flyout').set_namespace('ticker').set_ua_id('flyout'),flyout_prefetch:user_action('ticker_flyout_prefetch').set_namespace('ticker').set_ua_id('flyout_prefetch'),flyout_loadtime:user_action('ticker_flyout_loadtime').set_namespace('ticker').set_ua_id('flyout_loadtime'),stream:user_action('ticker_stream').set_namespace('ticker').set_ua_id('stream')};this._uaCurStoryIDFetch=null;this._uaCurStoryIDPrefetch=null;var e=$N('div',{className:'storyQueue hidden_elem'});this._storyQueue=e;DOM.appendContent(this._root,e);this._initObjectIDs();this._initPageletCache(c);this._initConfig(c);this._resetMorePager();this._initListeners();this._initSubscriptions(c);Arbiter.inform('ticker/init',this,Arbiter.BEHAVIOR_PERSISTENT);this._poll();if(this._prefetchAfterLoad){this._logUserEvent('stream','prefetch');this._fetchStories(this._getInsertedStories().slice(0,5));}},_loadStoriesWithActions:function(){var a=ge('rightCol');if(!a)return;this._toggleWrapper=DOM.scry(a,'.tickerToggleWrapper')[0];if(this._toggleWrapper){var b=DOM.scry(this._stories,'.tickerStoryWithButton');this._storiesWithActions={};for(var c=0;c<b.length;c++){var d=b[c];this._storiesWithActions[d.getAttribute('data-story-key')]=d;}}},_initPageletCache:function(a){if(window.PageletCacheController){this._cache=PageletCacheController.registerController(this._root.parentNode.id,this);if(this._cache){copy_properties(a,this._cache.loadData());this._cache.registerCleanup('Ticker/cleanup');}}},_initConfig:function(a){copy_properties(this,{_newest:a.newest,_page_newest:a.newest,_timeout:a.timeout,_heartbeatTimeout:Math.max(15000,a.heartbeatTimeout),_pullTimeout:Math.max(30000,a.pullTimeout),_insertTimeout:a.insertTimeout,_friendCount:a.friendCount,_maxQueueLength:a.maxQueueLength,_heartbeatEndpoint:a.heartbeatEndpoint,_noPoll:a.nopoll,_maxCustomQueueLength:a.maxCustomQueueLength,_customStoryInsertTimeout:Math.max(5000,a.customStoryInsertTimeout),_nonCustomToCustomStoryRatio:a.nonCustomToCustomStoryRatio,_minForceUpdateInterval:Math.max(a.insertTimeout,a.minForceUpdateInterval),_popupOnHover:a.popupOnHover,_priorityAppId:a.priorityAppId,_prefetchOnHover:a.prefetchStoriesOnHover,_userIdleTimeout:a.userIdleTimeout,_firstCustomStoryDelay:a.firstCustomStoryDelay,_pollOnly:a.pollOnly,_tickerDebug:a.tickerDebug,_tickerSource:a.tickerSource,_prefetchAfterLoad:a.prefetchAfterLoad,_logFlyouts:a.logFlyouts,_userScrollGaurdDelay:a.userScrollGaurdDelay,_rescheduleScrollToTopDelay:a.rescheduleScrollToTopDelay,_aggressiveRegulator:a.aggressiveRegulator});this._queueCustomStories(a.customStories);},_initListeners:function(){this._listeners=Event.listen(this._root,{click:this._handleClick.bind(this),keydown:this._handleKeydown.bind(this),mouseout:this._handleMouseout.bind(this),mouseover:this._handleMouseover.bind(this),mousedown:this._tickerDeClicker.bind(this),mouseup:this._handleMouseup.bind(this)});this._listeners.scroll=Event.listen(this._container,'scroll',throttle(this._handleScroll.bind(this)));this._initInfiniteScrollListener.bind(this).defer();},_initSubscriptions:function(a){onleaveRegister(this._cleanup.bind(this));this._subscriptions=[Arbiter.subscribe(NavigationMessage.NAVIGATION_BEGIN,this._onNavHandler.bind(this)),Arbiter.subscribe(ChannelConstants.getArbiterType('ticker_update'),this._handleTickerPush.bind(this)),Arbiter.subscribe('composer/publish',this._handleComposerPublish.bind(this)),Arbiter.subscribe('Ticker/storiesInserted',this._handleStoriesInserted.bind(this)),Arbiter.subscribe('Ticker/fixed',this._setFixed.bind(this,true)),Arbiter.subscribe('Ticker/unfixed',this._setFixed.bind(this,false)),Arbiter.subscribe('Ticker/resized',this._checkInfiniteScroll.bind(this)),Arbiter.subscribe(UFIOptimistic.COMMENT_SEND_EVENT,this._scrollDialogToBottom.bind(this)),Arbiter.subscribe('Ticker/chatOpened',this._handleChatOpened.bind(this))];if(a.pushChannel)this.setPushChannel(a.pushChannel);},_handleClick:function(event){var a=event.getTarget();if(this._getButtonFromNode(a)){this._logUserAction(a,'click',event);this._handleActionButton(event);return;}var b=this._getStoryFromNode(a),c=Parent.byClass(a,'tickerStoryAllowClick');if(!b||b==this._selectedStory||c)return;if(this._storyIsHidden(b))return;if(b==this._activeStory&&!this._selectedStory)this._selecting=true;this._clearNux();this._logUserEvent('flyout','click');this._logUserEvent('flyout_loadtime','open');if(this._storyCanOpenExternally(b)){var d=b.getAttribute('data-href');if(d&&!a.getAttribute('href')){var e={href:d},f=collect_data_attribs(a,['ft','gt']);user_action('click',e,event,'FORCE',f);}else this._logUserAction(a,'click',event);this._openStoryExternally(b,event);return;}this._logUserAction(a,'flyout',event);this._activateStory(b,'click');this._selectStory(b);},_handleMouseover:function(event){this._setLocked(true);var a=event.getTarget(),b=this._getOpenableStory(a);if(!b)return;event.kill();if(this._prefetchOnHover||this._popupOnHover){if(!(b.id in this._fetchedStories)){this._logUserEvent('flyout_prefetch','prefetch_on_hover');this._uaCurStoryIDPrefetch=b.id;}this._fetchStory(b);}if(this._selectedStory)return;if(this._popupOnHover){this._clearHoverTimeouts();var c=this._storyCanOpenExternally(b)?500:1000,d=this._activeStory?75:c;if(!window.addEventListener&&document.createEventObject)event=document.createEventObject(event);this._hoverShowTimeout=this._setTimeout(function(){this._logUserEvent('flyout','hover',d);this._logUserEvent('flyout_loadtime','open');this._activateStory(b,'hover');this._logUserAction(a,'flyout',event);}.bind(this),d);}},_handleMouseout:function(event){var a=event.getTarget();this._setLocked(false);if(a==this._getStoryFromNode(a)){var b=DOM.scry(a.parentNode,'.openToggler');for(var c=0;c<b.length;c++)Selector.toggle(b[c]);}this._clearClickedStory();this._scheduleHide();},_handleKeydown:function(event){this._tickerDeClicker(event);var a=this._activeStory;if(!a)return;var b=Event.getKeyCode(event);switch(b){case KEYS.UP:case KEYS.DOWN:var c=this._getInsertedStories(),d;if(event.getModifiers().any){d=b===KEYS.UP?0:c.length-1;}else d=c.indexOf(a)+(b===KEYS.UP?-1:1);a=c[d];break;case KEYS.ESC:this._deactivateStory(true);return;default:return;}if(!a)return;event.kill();this._activateStory(a,'keypress');this._selectStory(a);},_fadeTopmostStoryButton:function(){var a=0,b=15;if(this._storiesWithActions)for(var c in this._storiesWithActions){var d=this._storiesWithActions[c],e=DOM.scry(d,'.tickerInlineActionButton')[0],f=DOM.scry(e,'.tickerActionIcon')[0],g=Vector2.getElementPosition(e).y-Vector2.getElementPosition(this._toggleWrapper).y;if(g<a){CSS.setStyle(e,'opacity',0);CSS.setStyle(f,'opacity',0);}else if(g>=a&&g<b){var h=(g-a)/(b-a);CSS.setStyle(e,'opacity',h);CSS.setStyle(f,'opacity',h);break;}else{CSS.setStyle(e,'opacity',1);CSS.setStyle(f,'opacity',1);}}},_handleScroll:function(){this._fadeTopmostStoryButton();!this._preventScrollDismiss&&this._deactivateStory(true);this._checkInfiniteScroll();this._setIsUserScrolling();if(!this._scrollLogged){this._scrollLogged=true;var a=this._stories.childNodes.length,b=this._stories.getAttribute('data-gt'),c={ticker_scroll:1,number_stories:a,source:b};report_data('scroll',{gt:c});}},_setIsUserScrolling:function(){clearTimeout(this._userScrollingToken);if(this._isScrolledToTop()){this._userScrolling=false;return;}this._userScrolling=true;this._userScrollingToken=setTimeout(function(){this._userScrolling=false;this._userScrollingToken=null;}.bind(this),this._userScrollGaurdDelay);},_isUserScrolling:function(){return this._userScrolling;},_handleStoriesInserted:function(){this._initInfiniteScrollListener();this._scrollableArea.adjustGripper();this._logUserEvent('stream','insert');},_handleActionButton:function(event){var a=event.getTarget(),b=this._getButtonFromNode(a),c=this._getOpenableStory(a),d=this._getStoryDialog(c);if(d)var e=d.subscribe('beforehide',function(){d.unsubscribe(e);return false;});},_handleScrollToTopClick:function(){this._scrollToTop(this._poll.bind(this));},_scheduleScrollToTop:function(){this._scrollToTopToken&&clearTimeout(this._scrollToTopToken);this._scrollToTopToken=setTimeout(function(){if(this._isLocked()||this._isUserScrolling()){this._scheduleScrollToTop();}else{this._scrollToTopToken=null;this._scrollToTop();}}.bind(this),this._rescheduleScrollToTopDelay);},_scrollToTop:function(a){animation(this._container).to('scrollTop',0).ease(animation.ease.end).ondone(a).go();},_clearHoverTimeouts:function(){clearTimeout(this._hoverShowTimeout);clearTimeout(this._hoverHideTimeout);},_getAllStories:function(){return DOM.scry(this._root,'div.fbFeedTickerStory');},_getInsertedStories:function(){return this._getAllStories().filter(function(a){return !CSS.hasClass(a,'queuedStory')&&!CSS.hasClass(a,'customStory');});},_getQueuedStories:function(){return DOM.scry(this._storyQueue,'.fbFeedTickerStory.queuedStory');},_getQueuedCustomStories:function(){return DOM.scry(this._storyQueue,'.fbFeedTickerStory.customStory');},_getButtonFromNode:function(a){return Parent.byClass(a,'tickerInlineOverlay');},_getStoryFromNode:function(a){return Parent.byClass(a,'fbFeedTickerStory');},_getActionButtonFromStory:function(a){return DOM.scry(a,'.tickerInlineActionButton')[0];},_getOpenableStory:function(a){var b=this._getStoryFromNode(a);return this._storyCanOpenDialog(b)?b:null;},_getStoryDialog:function(a){return window.ContextualDialogX&&ContextualDialogX.getInstance(a)||null;},_getStoryDialogEndpoint:function(a){return a&&a.getAttribute('data-rel')=='async'&&a.getAttribute('data-ajaxify')||null;},_storyCanOpenDialog:function(a){return !!this._getStoryDialogEndpoint(a)&&!this._storyIsHidden(a);},_storyCanOpenExternally:function(a){return !!a.getAttribute('data-href')||!this._storyCanOpenDialog(a);},_storyIsHidden:function(a){return CSS.hasClass(a,'tickerStoryHidden');},hideActiveStory:function(){this._activeStory&&this.hideStory(this._activeStory);},hideStory:function(a){this._deactivateStory();CSS.addClass(a,'tickerStoryHidden');CSS.removeClass(a,'tickerStoryClickable');},undoHideStory:function(a){CSS.addClass(a,'tickerStoryClickable');CSS.removeClass(a,'tickerStoryHidden');},_scheduleHide:function(){if(this._popupOnHover&&!this._selectedStory){this._clearHoverTimeouts();this._hoverHideTimeout=this._setTimeout(this._deactivateStory.bind(this),100);}},_setScrollTopPromptVisible:function(a){this._scrollTopPromptVisible=a;CSS.conditionShow(this._scrollTopPrompt,a);if(a&&!this._listeners.scrollTop){this._listeners.scrollTop=Event.listen(this._scrollTopPrompt,{click:this._handleScrollToTopClick.bind(this)});}else if(!a&&this._listeners.scrollTop){this._listeners.scrollTop.click.remove();this._listeners.scrollTop=null;}},_isUserIdle:function(){return !UserActivity.isActive(this._userIdleTimeout);},_schedulePoll:function(){clearTimeout(this._pollToken);this._pollToken=this._setTimeout(this._poll.bind(this),this._timeout);},_poll:function(){this._debug('poll');if(!this._isTickerVisible()){this._debug('not polling: ticker not visible');return;}if(this._storiesToRemove.length>0){if(this._isInsertingStory)return this._schedulePoll();var a=this._storiesToRemove.pop();this.removeStory(a);}if(this._isUserIdle()){this._debug('not polling: idle');return UserActivity.subscribeOnce(this._poll.bind(this));}var b=!this._isScrolledToTop()&&this._getQueuedStories().length;this._setScrollTopPromptVisible(b);var c=Date.now(),d=c-this._lastInsert;if(d<this._insertTimeout||this._isLocked())return this._schedulePoll();var e=this._getQueuedStories(),f=this._getQueuedCustomStories(),g=e.length>0,h=f.length>0&&(c-this._initTime>this._firstCustomStoryDelay)&&(this._needNonCustomStoryNum===0||(!g&&(c-this._lastCustomStory)>this._customStoryInsertTimeout));if(h){this.insertStory(f.shift());this._lastCustomStory=c;this._needNonCustomStoryNum=this._nonCustomToCustomStoryRatio;this._debug('not polling: should insert custom story');return this._schedulePoll();}if(g){this.insertStory(e.shift());this._needNonCustomStoryNum--;if(this._needNonCustomStoryNum<0)this._needNonCustomStoryNum=0;this._debug('not polling: should insert story');return this._schedulePoll();}var i=f.length===0&&this._needNonCustomStoryNum===0&&this._nonCustomToCustomStoryRatio>0&&UserActivity.isActive(this.ADS_IDLE_MS)&&((c-this._lastUpdate)>this._minForceUpdateInterval),j=false,k=false;if(this._pollOnly){k=c-this._lastUpdate>this._heartbeatTimeout;}else j=(c-this._lastPull>this._pullTimeout);var l=(i&&this._doCustomUpdate)||j||k;if(!l)return this._schedulePoll();if(i)this._doCustomUpdate=false;this._debug('polling for new stories');this.update({pull:j,fullpoll:k,needcustomstory:i});},update:function(a){if(this._noPoll&&!this._pollOnly){this._debug('not updating - in no poll mode');return this._schedulePoll();}var b={newest:(a.fullpoll||a.cache_update)?this._newest:this._page_newest,storyids:this._storyIDs,friendcount:this._friendCount,priorityappid:this._priorityAppId,source:this._tickerSource,needcustomstory:this._nonCustomToCustomStoryRatio>0};copy_properties(b,a);new AsyncRequest().setURI(this._heartbeatEndpoint).setReadOnly(true).setOption('retries',0).setData(b).setHandler(this._handleResponse.bind(this)).setFinallyHandler(this._poll.bind(this)).setAllowCrossPageTransition(true).send();this._lastUpdate=Date.now();if(b.pull)this._lastPull=this._lastUpdate;this._storyIDs=[];},insertStory:function(a,b,c){this._lastInsert=Date.now();window.LiveTimer&&LiveTimer.addTimeStamps(a);CSS.removeClass(a,'queuedStory');CSS.removeClass(a,'customStory');if(b!==false){var d=c?this._fadeStoryIn:this._flyStoryIn;if(this._isUserScrolling()){var e=function(){this._container.scrollTop=this._container.scrollTop+this._stories.firstChild.offsetHeight;this._scheduleScrollToTop();}.bind(this);this._fadeStoryIn(a,e);this._debug("insertStory: scheduled a scroll to top");}else this._scrollToTop(d.bind(this,a));}else DOM.prependContent(this._stories,a);if(this._storiesWithActions&&CSS.hasClass(a,'tickerStoryWithButton'))this._storiesWithActions[a.getAttribute('data-story-key')]=a;this._removeOldStories();},_removeOldStories:function(){var a=this._getInsertedStories();if(a.length<=this._maxStoriesToKeep)return;var b=this._minStoriesToKeep,c=a.slice(b);c.forEach(DOM.remove);if(this._storiesWithActions)for(var d=0;d<c.length;d++)delete this._storiesWithActions[c[d].getAttribute('data-story-key')];this._resetMorePager();},_resetMorePager:function(){var a=this._getInsertedStories();if(!a||!a.length)return;var b=a[a.length-1].getAttribute('data-ticker-timestamp'),c=DOM.scry(this._root,'.tickerMorePager a')[0];if(!c||!b)return;var d=new URI(c.getAttribute('ajaxify'));d.addQueryData({oldest:b});c.setAttribute('ajaxify',d);},_setLocked:function(a){this._locked=a;},_isLocked:function(){return !!(this._locked||this._activeStory);},informAndRemoveStory:function(a,b,c){var d=this._getStoryFromNode(a),e=d.getAttribute('data-story-key');DOM.setContent(d,b);CSS.addClass(d,'highlightedStory');this._setTimeout(this.removeStory.bind(this,e),c||6000);},_getStoryByStoryKey:function(a){var b=this._getAllStories();for(var c=0;c<b.length;c++){var d=b[c];if(d.getAttribute('data-story-key')==a)return d;}return null;},removeStory:function(a){this._removedStoryIDs[a]=true;var b=this._getStoryByStoryKey(a);if(!b)return;if(this._storiesWithActions)delete this._storiesWithActions[a];if(b==this._activeStory)this._deactivateStory();var c=this._getStoryDialog(b);c&&c.destroy();if(CSS.hasClass(b,'queuedStory')){DOM.remove(b);return;}this._animateStoryOut(b);},_isScrolledToTop:function(){return this._container.scrollTop<=this._scrollTopThreshold;},_flyStoryIn:function(a){var b=$N('div',{style:{marginTop:'-1000px'}},a);CSS.setStyle(b,'opacity',0);DOM.prependContent(this._stories,b);var c=Vector2.getElementDimensions(b).y;CSS.setStyle(b,'marginTop','-'+c+'px');this._isInsertingStory=true;animation(b).to('marginTop',0).ease(animation.ease.end).checkpoint(.5).to('opacity',1).ondone(function(){DOM.replace(b,a);this._afterInsert(a);this._isInsertingStory=false;}.bind(this)).go();},_fadeStoryIn:function(a,b){animation(this._stories).to('opacity',.5).ondone(function(){DOM.prependContent(this._stories,a);if(b)b();animation(this._stories).to('opacity',1).ondone(function(){this._afterInsert(a);}.bind(this)).go();}.bind(this)).go();},_animateStoryOut:function(a){var b=$N('div',{style:{overflow:'hidden',position:'relative'}});DOM.insertBefore(a,b);DOM.appendContent(b,a);animation(b).to('top',20).to('height',0).to('opacity',0).ease(animation.ease.end).ondone(function(){DOM.remove.curry(b);Arbiter.inform('Ticker/animateOut');}.bind(this)).go();},_afterInsert:function(a){Arbiter.inform('Ticker/afterInsert');},setPushChannel:function(a){this._pushSubscription&&this._pushSubscription.unsubscribe();this._pushSubscription=Arbiter.subscribe(ChannelConstants.getArbiterType(a),this._handleTickerPush.bind(this));requireLazy(['ChatConfig','ChannelConnection'],function(b,c){this._channelConnection=c;this._checkChannelConnection();this._channelConnectionSubscription=this._channelConnection.subscribe([this._channelConnection.CONNECTED,this._channelConnection.RECONNECTING,this._channelConnection.SHUTDOWN,this._channelConnection.MUTE_WARNING,this._channelConnection.UNMUTE_WARNING],this._handleChannelConnection.bind(this));}.bind(this));},_checkChannelConnection:function(){CSS.conditionClass(this._root,'disconnected',this._channelConnection.disconnected());},setCurrentAppId:function(a){this._priorityAppId=a;},_handleTickerPush:function(a,b){var c=b.obj;if(c.delete_id){this._storiesToRemove.push(c.delete_id);return;}if(c.fromups){this._debug('discarding story: dark launch');if(c.do_logging)this._logDarkLaunch(c);}var d=c.story_xhp;if(!d){this._debug('discarding story: no markup');return;}this._newest=c.story_time;var e=HTML(d).getRootNode();this.queueStory(e,c.flyout_js_cmds);if(this._aggressiveRegulator&&c.actor==this._newestStory.actorID){this.removeStory(this._newestStory.storyKey);new AsyncSignal('/common/ods_endpoint.php',{k:'ticker.aggr.remove'}).send();}this._newestStory={actorID:c.actor,storyKey:e.getAttribute('data-story-key')};},_handleComposerPublish:function(a,b){b.tickerMarkup&&this.insertStory(b.tickerMarkup);},_clearNux:function(){var a=DOM.scry(document.body,'div.tickerNUXContainer');if(a.length){a.forEach(function(b){var c=ContextualDialogX.getInstance(b);c&&c.hide();});new AsyncRequest().setURI('/ajax/feed/ticker/nux.php').send();}this._clearNux=bagofholding;},_logDarkLaunch:function(a){data={actor:a.actor,story_time:a.story_time,key:a.story_obj_id,dark:1};new AsyncRequest().setURI('/alite/push/log.php').setData({msg:JSON.stringify(data)}).send();},_logRender:function(){if(this._loggedRender)return;var a=this._tickerInSidebarMode;if(a||Parent.byClass(this._content,'home_right_column')){new AsyncSignal('/ajax/log_ticker_render.php',{sidebar_mode:a}).send();this._loggedRender=true;}},_isTickerVisible:function(){var a=(TickerController._activeInstance==this);a&&this._logRender();return a;},_handleResponse:function(a){var b=a.getPayload();if(b.newest)this._newest=this._page_newest=b.newest;if(b.content)if(b.cache_update&&this._cache){this._cache.insertStory(b.content);}else if(b.content instanceof Array){for(var c=0;c<b.content.length;c++)this.queueStoryMarkup(b.content[c]);}else this.queueStoryMarkup(b.content);if(b.custom_stories&&b.custom_stories.length){this._queueCustomStories(b.custom_stories);this._doCustomUpdate=true;}},queueStoryMarkup:function(a){var b=HTML(a).getRootNode();this.queueStory(b);},dedupeStory:function(a){var b=a.getAttribute('data-story-key'),c=b&&(!!this._objectIDs[b]||!!this._removedStoryIDs[b]);if(c)this._debug('discarding story: duplicated object id');b&&(this._objectIDs[b]=true);return c;},queueStory:function(a,b){if(this.dedupeStory(a))return;CSS.addClass(a,'queuedStory');DOM.appendContent(this._storyQueue,a);var c=b&&b.length;if(c)b.forEach(function(e){new Function(e).apply();});a.setAttribute('id',a.id+'_'+this._root.id);var d=this._getQueuedStories();d.slice(0,-this._maxQueueLength).forEach(DOM.remove);if(c)this._fetchedStories[a.id]=true;},_queueCustomStories:function(a){while(a.length){var b=a.shift();b=HTML(b).getRootNode();var c=b.getAttribute('data-story-key');if(this.dedupeStory(b))continue;CSS.addClass(b,'customStory');DOM.appendContent(this._storyQueue,b);}var d=this._getQueuedCustomStories();d.slice(0,-this._maxQueueLength).forEach(DOM.remove);},_cleanup:function(){TickerController._placeholders.pagelet_rhc_ticker=null;if(!Parent.byClass(this._content,'hasRightCol'))return;this._objectIDs=[];this._subscriptions.forEach(Arbiter.unsubscribe);this._channelConnectionSubscription&&this._channelConnection.unsubscribe(this._channelConnectionSubscription);this._pushSubscription&&this._pushSubscription.unsubscribe();for(var a in this._listeners)this._listeners[a]&&this._listeners[a].remove();clearTimeout(this._pollToken);this._pollToken=null;this._cleanupInputFocusListener();this._cleanupContentResizeListener();Arbiter.inform('Ticker/cleanup');},_onNavHandler:function(a,b){var c=b.params.key;if(c!='lf'&&c!='h')this._cleanup();},registerStoryDialog:function(a,b){if(this._uaCurStoryIDFetch==a.id){this._uaCurStoryIDFetch=null;this._logUserEvent('flyout','fetch_success');}if(this._uaCurStoryIDPrefetch==a.id){this._uaCurStoryIDPrefetch=null;this._logUserEvent('flyout_prefetch','prefetch_success');}this._fetchedStories[a.id]=true;b.setContext(a);b.subscribe('hide',this._deactivateStory.bind(this,true));b.subscribe('success',this._focusStory.bind(this,a));b.subscribe('beforehide',function(){if(this._selecting){this._selecting=false;return false;}}.bind(this));if(this._popupOnHover){b.subscribe('mouseenter',this._clearHoverTimeouts.bind(this));b.subscribe('mouseleave',this._scheduleHide.bind(this));b.subscribe('show',function(){this._highlightDialogScrollbar.bind(this,b).defer();var c=Event.listen(b.getContent(),'click',function(){this._selectStory(a);c.remove();}.bind(this));}.bind(this));}if(a==this._activeStory){this._logUserEvent('flyout_loadtime','show_fetched');this._logUserEvent('flyout','show');this._openDialog(b);}},_highlightDialogScrollbar:function(a){var b=DOM.scry(a.getContent(),'.uiScrollableArea')[0];b&&ScrollableArea.poke(b);},_openStoryExternally:function(a,event){var b=a.getAttribute('data-href');if(!b||b=='#')return;var c=a.getAttribute('data-story-rel');switch(c){case 'theater':this._deactivateAndClearStory();Bootloader.loadComponents('PhotoViewer',function(){PhotoViewer.bootstrap(b,a);});return;case 'async':this._deactivateAndClearStory();Bootloader.loadComponents('async',function(){AsyncRequest.bootstrap(b,a);});return;}var d=a.getAttribute('data-target'),e=(event.which!=1||event.getModifiers().any||d=='_blank');e?window.open(b,'_blank'):goURI(b);},_deactivateAndClearStory:function(){this._clearHoverTimeouts();this._deactivateStory();},_focusStory:function(a){clearTimeout(this._scrollDismissal);this._preventScrollDismiss=true;this._scrollDismissal=this._setTimeout(function(){this._preventScrollDismiss=false;}.bind(this),100);a.focus();},_selectStory:function(a){this._selectedStory=a;CSS.addClass(a,'tickerStorySelected');CSS.addClass(this._root,'tickerChildSelected');},_activateStory:function(a,b){this._clearHoverTimeouts();if(a==this._activeStory||!this._storyCanOpenDialog(a))return;this._deactivateStory();this._focusStory(a);this._activeStory=a;CSS.addClass(a,'tickerStoryActive');window.Toggler&&Toggler.hide();if(this._logFlyouts){b=b||'unknown';new AsyncSignal('/ajax/feed/ticker/flyout.php',{src:b}).send();}var c=this._getStoryDialog(a);if(c){this._logUserEvent('flyout_loadtime','show_prefetched');this._logUserEvent('flyout','show');this._openDialog(c);return;}if(!(a.id in this._fetchedStories)){this._uaCurStoryIDFetch=a.id;this._logUserEvent('flyout','fetch');}this._fetchStory(a);},_deactivateStory:function(a){if(this._activeStory===this._deactivatingStory)return;this._deactivatingStory=this._activeStory;if(this._dialog){if(a===true){this._dialog.enableBehavior(LayerFadeOnHide);}else this._dialog.disableBehavior(LayerFadeOnHide);this._dialog.hide();this._logUserEvent('flyout','close');}if(this._activeStory){CSS.removeClass(this._activeStory,'tickerStoryActive');CSS.removeClass(this._activeStory,'tickerStorySelected');CSS.removeClass(this._root,'tickerChildSelected');}this._dialog=this._selectedStory=this._activeStory=null;this._cleanupInputFocusListener();this._cleanupContentResizeListener();this._deactivatingStory=null;},_logUserAction:function(a,b,event){user_action(b,a,event,'FORCE',null);},_logUserEvent:function(a,event){if(this._ua[a])this._ua[a].add_event(event);},_fetchStory:function(a){clearTimeout(this._fetchToken);var b=[],c=this._getInsertedStories(),d=c.indexOf(a);[-1,0,1].forEach(function(e){var f=c[d+e];f&&b.push(f);},this);this._fetchToken=setTimeout(this._fetchStories.bind(this,b),100);},_fetchStories:function(a){var b=[],c,d=function(e){clearTimeout(c);a.forEach(function(f){CSS.conditionClass(f,'tickerStoryFetching',e);});};a=a.filter(function(e){if(e.id in this._fetchedStories)return false;this._fetchedStories[e.id]=true;var f=this._getStoryDialogEndpoint(e),g=URI(f).getQueryData();if(!f||!g)return false;g.uniq_id=e.getAttribute('id');g.referrer=this._tickerSource;b.push(g);return true;},this);if(!b.length)return;c=this._setTimeout(d.curry(true),500);new AsyncRequest('/ajax/feed/ticker/multi_story').setFinallyHandler(d.curry(false)).setErrorHandler(bagofholding).setData({stories:b}).setAllowCrossPageTransition(this._tickerInSidebarMode).send();},_tickerDeClicker:function(event){var a=event.getTarget(),b=Parent.byTag(a,'a'),c=this._getStoryFromNode(a),d=this._getButtonFromNode(a);if(c&&b&&!d&&CSS.hasClass(c,'tickerStoryClickable')&&!CSS.hasClass(b,'tickerStoryAllowClick')&&!this._storyIsHidden(c)){b.setAttribute('rel','ignore');b.removeAttribute('onclick');b.removeAttribute('ajaxify');b.removeAttribute('href');}var e=(event.button==2),f=c&&this._getActionButtonFromStory(c);if(!e&&f)this._setClickedStory(c);},_handleMouseup:function(event){this._clearClickedStory();},_setClickedStory:function(a){this._clearClickedStory();CSS.addClass(a,'tickerStoryClicked');this._clickedStory=a;},_clearClickedStory:function(){if(this._clickedStory){CSS.removeClass(this._clickedStory,'tickerStoryClicked');this._clickedStory=null;}},_initInfiniteScrollListener:function(){var a=this._getInsertedStories();if(this._storiesWithActions)for(var b=0;b<a.length;b++){var c=a[b];if(CSS.hasClass(c,'tickerStoryWithButton'))this._storiesWithActions[c.getAttribute('data-story-key')]=c;}var d=Math.max(0,a.length-this._autoloadStoryIndex);this._infiniteScrollStory=a[d];this._checkInfiniteScroll();},_checkInfiniteScroll:function(){if(this._infiniteScrollStory){var a=Vector2.getElementPosition(this._infiniteScrollStory).y,b=Vector2.getElementPosition(this._container).y+Vector2.getElementDimensions(this._container).y;if(a<b){var c=DOM.scry(this._root,'.tickerMorePager a')[0];if(c){var d=Parent.byClass(c,'stat_elem')||c,e=new AsyncRequest(c.getAttribute('ajaxify')).setReadOnly(true).setRelativeTo(c).setStatusElement(d).setAllowCrossPageTransition(true).send();this._logUserEvent('stream','scroll');}this._infiniteScrollStory=null;this._autoloadStoryIndex=5;}}},_setFixed:function(a){if(!this._selectedStory)return;var b=this._getStoryDialog(this._selectedStory);if(b){b.setFixed(a);b.updatePosition();}},_setTimeout:function(a,b){return setTimeout(a,b,!this._tickerInSidebarMode);},_scrollDialogToBottom:function(){var a=this._dialog&&this._dialog.getContent(),b=a&&DOM.scry(a,'.uiScrollableAreaWrap')[0],c=b&&ScrollableArea.getInstance(b);c&&c.scrollToBottom();},_openDialog:function(a){this._dialog=a.show();this._updateDialogPosition();this._writeSwfFrame(a);this._initCommentFocusListener.bind(this).defer();this._initContentResizeListener.bind(this).defer();this._stupidIE7VideoResizeHack(a);},_stupidIE7VideoResizeHack:function(a){if(ua.ie()===7){var b=DOM.scry(a.getContent(),'.uiVideoThumb .img');b.forEach(function(c){CSS.setStyle(c,'width','');});}},_updateDialogPosition:function(){var a=this._tickerInSidebarMode||!!Parent.byClass(this._root,'fixed_elem');this._dialog.setFixed(a);this._adjustFlyoutContentHeight();this._dialog.updatePosition();},_writeSwfFrame:function(a){var b=this._dialog&&this._dialog.getContent(),c=DOM.scry(b,'.swfObject')[0];if(!c)return;var d=c.getAttribute('data-swfid');if(d&&window[d]){var e=window[d];e.write(c);}},_initCommentFocusListener:function(){var a=this._dialog&&this._dialog.getContent(),b=a&&DOM.scry(a,'.tickerDialogFooter textarea')[0];if(!b)return;this._listeners.inputFocus=Event.listen(b,'focus',this._scrollDialogToBottom.bind(this));},_cleanupInputFocusListener:function(){if(this._listeners.inputFocus){this._listeners.inputFocus.remove();this._listeners.inputFocus=null;}},_initContentResizeListener:function(){var a=this._dialog&&this._dialog.getContent();if(!a)return;this._listeners.contentResize=Event.listen(a,'click',function(){this._dialog.updatePosition.bind(this._dialog).defer();}.bind(this));},_cleanupContentResizeListener:function(){if(this._listeners.contentResize){this._listeners.contentResize.remove();this._listeners.contentResize=null;}},_adjustFlyoutContentHeight:function(){var a=this._dialog&&this._dialog.getContent(),b=a&&DOM.scry(a,'.uiScrollableAreaWrap')[0];if(!b)return;var c=Vector2.getElementDimensions(b),d=Vector2.getElementPosition(b),e=DOM.scry(b,'.uiUfi .uiUfiComment'),f=Vector2.getViewportDimensions().y-this.FLYOUT_VIEWPORT_PADDING,g=Math.min(this.FLYOUT_MAX_HEIGHT,f),h=g-this.FLYOUT_TARGET_HEIGHT_OFFSET;for(var i=0;i<e.length;i++){var j=e[i],k=Vector2.getElementPosition(j),l=k.y-d.y;if(Math.abs(l-h)<=this.FLYOUT_OFFSET_THRESHOLD){h=l+this.FLYOUT_COMMENT_OFFSET;break;}}if(c.y>h){CSS.setStyle(b,'height',h+'px');CSS.setStyle(b,'max-height',null);}else{CSS.setStyle(b,'max-height',g+'px');CSS.setStyle(b,'height',null);}},_initObjectIDs:function(){stories=this._getAllStories();for(var a=0;a<stories.length;++a){var b=stories[a].getAttribute('data-story-key');b&&(this._objectIDs[b]=true);}},_handleChatOpened:function(){this._deactivateStory(true);},_handleChannelConnection:function(){this._checkChannelConnection();},_debug:function(a){this._tickerDebug&&false;},getNewest:function(){return this._newest;}});
function HomeTickerFirstRightColumnController(){}copy_properties(HomeTickerFirstRightColumnController.prototype,{_isFixed:false,_forcedStatic:false,_PADDING_RHC_TO_BOTTOM:75,_PADDING_RHC_TO_BOTTOM_SHORT:50,_TOP_PADDING:15,_refreshOn:false,_fixAdsOnScroll:false,init:function(a){copy_properties(this,{_adsRefreshInterval:a.adsRefreshInterval,_adsRefreshDelay:a.adsRefreshDelay,_adsRefreshOnmove:a.adsRefreshOnmove,_enableSidebar:a.enableSidebar,_fixAdsOnScroll:a.fixAdsOnScroll,_maxFixedAds:a.maxFixedAds,contentCol:$('contentCol'),blueBar:$('blueBar'),_tickerMaxHeight:(a.tickerMaxHeight||425),_tickerMinHeight:(a.tickerMinHeight||225),_tickerAbsMinHeight:(a.tickerAbsMinHeight||120),_listeners:[],_subscriptions:[]});this._listeners.push(Event.listen(window,'resize',throttle(this.handleResize.bind(this))));this.blueBarHeight=Vector2.getElementDimensions(this.blueBar).y;this.reloadRightCol();this._initSubscriptions();onleaveRegister(this.cleanup.bind(this));this._listeners.push(Event.listen(window,'scroll',throttle(this._handleScroll.bind(this))));if(this._adsRefreshOnmove)this._listeners.push(Event.listen(window,'mousemove',throttle(this._handleMove.bind(this))));this._lastAdLoadTime=Date.now();this._debounceReloadAdsIfNeeded=debounce(this._reloadAdsIfNeeded.bind(this),this._adsRefreshDelay,true);if(!CSS.hasClass(document.documentElement,'sidebarMode')){this._onSidebarHide();}else if(this._enableSidebar)this._onSidebarShow();this._handleAdsLoad();},_handleAdsLoad:function(){var a=this.handleResize.bind(this);function b(){a.defer();}var c=DOM.scry(this.egoPagelet,'img.img');c.forEach(function(d){if(!d.complete)Event.listen(d,{load:b,error:b,abort:b});});b();},_initSubscriptions:function(){this._subscriptions=[Arbiter.subscribe('page_transition',this.cleanup.bind(this)),Arbiter.subscribe('Ticker/storiesInserted',this.handleResize.bind(this)),Arbiter.subscribe('concierge/load',this.handleResize.bind(this)),Arbiter.subscribe(UIIntentionalStreamMessage.INSERT_STORIES,this.handleResize.bind(this))];if(this._enableSidebar){this._subscriptions.push(Arbiter.subscribe('sidebar/hide',this._onSidebarHide.bind(this)));this._subscriptions.push(Arbiter.subscribe('sidebar/show',this._onSidebarShow.bind(this)));}},reloadRightCol:function(){this.rightColumn=DOM.scry(ge('rightCol'),'div.home_right_column')[0];this.rightColumnWrapper=DOM.find(this.rightColumn,'div.rightColumnWrapper');this.egoPagelet=ge('pagelet_ego_pane_w');if(!this.egoPagelet)this.egoPagelet=ge('pagelet_ego_pane_m');this._refreshOn=!this.containsPremium();this.tickerPagelet=ge('pagelet_rhc_ticker');if(!this.tickerPagelet)return false;this.tickerContainer=DOM.scry(this.tickerPagelet,'.ticker_container')[0];this.tickerStream=DOM.scry(this.tickerPagelet,'.ticker_stream')[0];return this.tickerContainer&&this.tickerStream;},containsPremium:function(){if(this.egoPagelet){var a=DOM.scry(this.egoPagelet,'.fbAdUnit');for(var b=0;b<a.length;b++){var c=JSON.parse(a[b].getAttribute('data-ad')).segment;if(c==='premium')return true;}}return false;},cleanup:function(a,b){if(a==='page_transition'&&b&&b.uri){var c=b.uri;if(c.path==='/photo.php'){this._inSnowbox=true;return;}if(this._inSnowbox&&c.path==='/'){this._inSnowbox=false;return;}}this._subscriptions.forEach(Arbiter.unsubscribe);this._subscriptions=[];this._listeners.forEach(function(d){d.remove();});this._listeners=[];this._debounceReloadAdsIfNeeded.reset();},_calculateDistanceFromTopOfRHCToTopOfAds:function(){if(this.forceFixingEvaluation||!this._isFixed)this.distanceFromTopOfRHCToTopOfAds=Vector2.getElementPosition(this.egoPagelet,'viewport').y-Vector2.getElementPosition(this.rightColumnWrapper,'viewport').y;},_handleScroll:function(){this._debounceReloadAdsIfNeeded();this._calculateDistanceFromTopOfRHCToTopOfAds();this._topOffset=this.blueBarHeight+Vector2.getElementPosition(this.blueBar,'viewport').y;var a=this._topOffset,b=Vector2.getElementPosition(this.rightColumn,'viewport').y;if(this._forcedStatic||!this.tickerStream){if(this._fixAdsOnScroll&&this.adsStickPoint!==null){var c=b+this.distanceFromTopOfRHCToTopOfAds,d=c<=a-this.adsStickPoint;if(this.forceFixingEvaluation||d!==this._isFixed){this.forceFixingEvaluation=false;var e=a-this.adsStickPoint-this.distanceFromTopOfRHCToTopOfAds;this._setFixed(d,e);}}return;}var f=b<=a+this._TOP_PADDING;if(f!==this._isFixed)this._setFixed(f);},_handleMove:function(){this._debounceReloadAdsIfNeeded();},_reloadAdsIfNeeded:function(){var a=Date.now();if(this._refreshOn&&this._adsRefreshInterval>0&&a-this._lastAdLoadTime>=this._adsRefreshInterval)this._reloadAds();},_reloadAds:function(){this._lastAdLoadTime=Date.now();UIPagelet.loadFromEndpoint('WebEgoPane',this.egoPagelet,{pid:27,data:{organic_only:false,ads_only:false,is_refresh:true}},{crossPage:false,handler:this._handleAdsLoad.bind(this)});},_recalculateAndReposition:function(){this.forceFixingEvaluation=true;this._calculateDistanceFromTopOfRHCToTopOfAds();this._recalculateFixingPosition();this._handleScroll();},_recalculateFixingPosition:function(){if(!this._fixAdsOnScroll)return;var a=Vector2.getViewportDimensions().y-this.blueBarHeight-this._PADDING_RHC_TO_BOTTOM_SHORT,b=Vector2.getElementDimensions(this.rightColumnWrapper).y;if(b<=a){this.adsStickPoint=0-this.distanceFromTopOfRHCToTopOfAds-this._TOP_PADDING;return;}var c=b-this.distanceFromTopOfRHCToTopOfAds,d=DOM.scry(this.egoPagelet,'div.egoOrganicColumn')[0];if(c<=a&&d){this.adsStickPoint=0;}else{var e=DOM.scry(this.egoPagelet,'div.ego_unit').reverse(),f=DOM.scry(this.egoPagelet,'div.fbAdUnit').length,g=this._maxFixedAds;if(f<=this._maxFixedAds)g=e.length;var h=null;for(var i=0;i<g;i++){var j=e[i],k=Vector2.getElementPosition(j,'viewport').y-Vector2.getElementPosition(this.rightColumnWrapper,'viewport').y,l=Vector2.getElementDimensions(this.rightColumnWrapper).y-k;if(l>a){if(i>0)h=e[i-1];break;}if(i==g-1)h=j;}if(h==null){this.adsStickPoint=null;}else this.adsStickPoint=Vector2.getElementPosition(h,'viewport').y-Vector2.getElementPosition(this.egoPagelet,'viewport').y;}},_setFixed:function(a,b){this._isFixed=a;b=b||this._topOffset;var c=a?b+'px':'';CSS.setStyle(this.rightColumnWrapper,'top',c);CSS.conditionClass(this.rightColumnWrapper,'fixed_elem',a);var d=DOM.scry(this.rightColumnWrapper,'div.displayedTickerToggleWrapper')[0];d&&CSS.conditionClass(d,'toggleWrapperWithoutMargin',this._fixAdsOnScroll&&a&&!this.tickerStream);if(this._sidebarIsHidden){var e=a?'Ticker/fixed':'Ticker/unfixed';Arbiter.inform(e);}},handleResize:function(){if(!this._sidebarIsHidden||!this.tickerStream||CSS.hasClass(document.documentElement,'tinyViewport')){this._recalculateAndReposition();return;}this._handleScroll();var a=Vector2.getViewportDimensions().y,b=61,c=Vector2.getElementDimensions(this.rightColumnWrapper).y-Vector2.getElementDimensions(this.tickerContainer).y,d=Vector2.getElementDimensions(this.tickerStream).y,e=a-c-this._PADDING_RHC_TO_BOTTOM-this._topOffset-b,f=this._tickerAbsMinHeight,g=this._tickerMinHeight;this._forcedStatic=false;if(e<f){this._forcedStatic=true;this._setFixed(false);e=f;}else if(e<g)if(e>(g-b)){e=g;}else e+=b;var h=Math.min(e,d,this._tickerMaxHeight);CSS.setStyle(this.tickerContainer,'height',h+'px');},_onSidebarHide:function(){this._sidebarIsHidden=true;this.reloadRightCol();var a=function(){if(this.reloadRightCol()){this._forcedStatic=false;this._handleScroll();this.handleResize();}};this.tickerPagelet&&TickerController.show(this.tickerPagelet,a.bind(this));},_onSidebarShow:function(){this._sidebarIsHidden=false;this.reloadRightCol();if(this._fixAdsOnScroll){this._recalculateAndReposition();}else{this._forcedStatic=true;this._setFixed(false);}this.tickerPagelet&&TickerController.hide(this.tickerPagelet);}});
__d("ContextualLayerAsyncRelative",["event-extensions","copyProperties","Parent"],function(a,b,c,d,e,f){b('event-extensions');var g=b('copyProperties'),h=b('Parent');function i(j){this._layer=j;}g(i.prototype,{_layerSubscription:null,_listener:null,enable:function(){this._layerSubscription=this._layer.subscribe('show',this._attachListener.bind(this));if(this._layer.isShown())this._attachListener();},disable:function(){this._layer.unsubscribe(this._layerSubscription);this._layerSubscription=null;if(this._listener){this._listener.remove();this._listener=null;}},_attachListener:function(){this._listener=Event.listen(this._layer.getRoot(),'click',this._onclick.bind(this));},_onclick:function(j){var k=h.byTag(j.getTarget(),'A');if(!k)return;var l=k.getAttribute('ajaxify'),m=k.href,n=l||m;if(k.rel==='async'||k.rel==='async-post'){d(['AsyncRequest'],function(o){o.bootstrap(n,this._layer.getContext(),k.rel==='async-post');}.bind(this));return false;}}});e.exports=i;});
__d("MenuX",["event-extensions","Class","copyProperties","CSS","DataStore","DOM","HTML","Keys","Parent","PopoverMenuInterface","ScrollableArea","Style","UserAgent"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Class'),h=b('copyProperties'),i=b('CSS'),j=b('DataStore'),k=b('DOM'),l=b('HTML'),m=b('Keys'),n=b('Parent'),o=b('PopoverMenuInterface'),p=b('ScrollableArea'),q=b('Style'),r=b('UserAgent');function s(t,u,v,w){this.parent.construct(this);this._id=t;this._className=u;this._items=[];for(var x=0;x<v.length;x++)this._items[x]=new v[x].ctor(v[x]);this._config=w;}g.extend(s,o);h(s.prototype,{_focused:null,_root:null,addItem:function(t){this._items.push(t);if(this._root)this._insertItem(t);},getRoot:function(){if(!this._root)this._render();return this._root;},onShow:function(){if(this._config.maxheight)if(!this._scrollableArea){q.set(this._scrollableElems.root,'width',this._scrollableElems.body.offsetWidth+'px');this._scrollableArea=p.fromNative(this._scrollableElems.root,{fade:true});q.set(this._scrollableElems.wrap,'max-height',this._config.maxheight+'px');}else{q.set(this._scrollableElems.root,'width','');q.set(this._scrollableElems.body,'width','');if(r.ie()<=7){q.set(this._scrollableElems.root,'width',this._scrollableElems.body.offsetWidth+'px');}else q.set(this._scrollableElems.root,'width',this._scrollableElems.root.offsetWidth+'px');this._scrollableArea.resize();}},onHide:function(){this.blur();},focusAnItem:function(){return this._attemptFocus(0,1);},blur:function(){if(this._focused){this._focused.blur();this._focused=null;this.inform('blur');}},handleKeydown:function(t){var u=this._items.indexOf(this._focused);switch(t){case m.UP:case m.DOWN:var v=t===m.UP?-1:1;if(u!==-1){return this._attemptFocus(u+v,v);}else if(t===m.UP){return this._attemptFocus(this._items.length-1,-1);}else return this._attemptFocus(0,1);break;case m.SPACE:if(this._items.indexOf(this._focused)!==-1){this._handleItemClick(this._focused);return true;}return false;default:var w=String.fromCharCode(t).toLowerCase(),x;for(var y=u+1;y<this._items.length;y++){x=this._items[y].getAccessKey();if(x&&x.charAt(0).toLowerCase()===w)if(this._focusItem(this._items[y]))return true;}return false;}},_render:function(){this._ul=k.create('ul',{className:'uiMenuX'});this._ul.setAttribute('role','menu');this._items.forEach(this._insertItem.bind(this));Event.listen(this._ul,'click',this._handleClick.bind(this));Event.listen(this._ul,'mouseover',this._handleMouseOver.bind(this));Event.listen(this._ul,'mouseout',this._handleMouseOut.bind(this));var t=this._ul;if(this._config.maxheight){this._scrollableElems=p.renderDOM();k.setContent(this._scrollableElems.body,this._ul);t=this._scrollableElems.root;}var u='uiMenuXWrapper'+(this._className?' '+this._className:'');this._root=k.create('div',{className:u},k.create('div',{className:'uiMenuXBorder'},t));this._id&&this._root.setAttribute('id',this._id);},_handleClick:function(t){var u=this._getItemInstance(t.getTarget());if(u)return this._handleItemClick(u);},_handleItemClick:function(t){this.inform('itemclick',t);if(t.hasAction())this.done();return t.handleClick();},_handleMouseOver:function(t){var u=this._getItemInstance(t.getTarget());u&&this._focusItem(u);},_handleMouseOut:function(t){var u=this._getItemInstance(t.getTarget());if(u&&this._focused===u)this.blur();},_insertItem:function(t){var u=t.getRoot();i.addClass(u,'__MenuXItem');j.set(u,'MenuXItem',t);k.appendContent(this._ul,u);},_attemptFocus:function(t,u){var v=this._items[t];if(v)if(this._focusItem(v)){return true;}else return this._attemptFocus(t+u,u);return false;},_focusItem:function(t){if(t.focus()!==false){if(this._focused!==t){this.blur();this._focused=t;this.inform('focus');}return true;}return false;},_getItemInstance:function(t){var u=n.byClass(t,'__MenuXItem');return u?j.get(u,'MenuXItem'):null;}});e.exports=s;});
__d("MenuXItemInterface",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(){}g(h.prototype,{_root:null,getRoot:function(){if(!this._root)this._root=this.render();return this._root;},render:bagofholding,getAccessKey:bagofholding,hasAction:bagof(false),focus:bagof(false),blur:bagof(false),handleClick:bagof(false)});e.exports=h;});
__d("MenuXItemBase",["Class","copyProperties","CSS","DOM","HTML","MenuXItemInterface"],function(a,b,c,d,e,f){var g=b('Class'),h=b('copyProperties'),i=b('CSS'),j=b('DOM'),k=b('HTML'),l=b('MenuXItemInterface');function m(n){this.parent.construct(this);this._data=n;}g.extend(m,l);h(m.prototype,{render:function(){var n='uiMenuXItem';if(this._data.className)n+=' '+this._data.className;var o={className:n,'aria-selected':'false'};for(var p in this._data)if(p.indexOf('data-')===0)o[p]=this._data[p];return j.create('li',o,this._renderItemContent());},_renderItemContent:function(){return k(this._data.markup).getNodes();}});e.exports=m;});
__d("MenuXItem",["event-extensions","Class","copyProperties","CSS","DOM","KeyStatus","MenuXItemBase"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Class'),h=b('copyProperties'),i=b('CSS'),j=b('DOM'),k=b('KeyStatus'),l=b('MenuXItemBase');function m(n){this.parent.construct(this,n);}g.extend(m,l);h(m.prototype,{getValue:function(){return this._data.value;},getAccessKey:function(){return this._data.label&&this._data.label.charAt(0);},hasAction:bagof(true),focus:function(){if(!this._root.offsetParent)return false;i.addClass(this._anchor,'highlighted');i.addClass(this._root,'selected');this._root.setAttribute('aria-selected','true');if(k.isKeyDown())this._anchor.focus();},blur:function(){i.removeClass(this._anchor,'highlighted');i.removeClass(this._root,'selected');this._root.setAttribute('aria-selected','false');},handleClick:function(){if(typeof this._onclickHandler==='function')return this._onclickHandler();return !!((this._data.rel&&this._data.rel!=='ignore')||this._data.href);},setOnClickHandler:function(n){this._onclickHandler=n;},_renderItemContent:function(){this._anchor=j.create('a',{className:'itemAnchor'},j.create('span',{className:'itemLabel'},this._data.markup));if(this._data.icon_markup){j.prependContent(this._anchor,this._data.icon_markup);i.addClass(this._anchor,'hasIcon');}this._anchor.setAttribute('href',this._data.href||'#');if(this._data.rel){this._anchor.setAttribute('rel',this._data.rel);}else if(!this._data.href)this._anchor.setAttribute('rel','ignore');if(this._data.ajaxify)this._anchor.setAttribute('ajaxify',this._data.ajaxify);if(this._data.target)this._anchor.setAttribute('target',this._data.target);this._anchor.setAttribute('role','menuitem');this._anchor.setAttribute('title',this._data.title);return this._anchor;}});e.exports=m;});
__d("MenuXSelectableItem",["Class","copyProperties","CSS","MenuXItem"],function(a,b,c,d,e,f){var g=b('Class'),h=b('copyProperties'),i=b('CSS'),j=b('MenuXItem');function k(l){this.parent.construct(this,l);}g.extend(k,j);h(k.prototype,{_selected:false,getLabel:function(){return this._data.label;},getIcon:function(){return this._data.icon_markup;},isSelected:function(){return this._selected;},select:function(){i.addClass(this._root,'checked');this._selected=true;},deselect:function(){i.removeClass(this._root,'checked');this._selected=false;},render:function(){var l=this.parent.render();if(this._data.selected){i.addClass(l,'checked');this._selected=true;}return l;}});e.exports=k;});
__d("collectSubtreeData",[],function(a,b,c,d,e,f){function g(i,j,k,l,m){if(i.offsetWidth===0&&i.offsetHeight===0)return m;var n={};if(i.getAttribute)for(r=0;r<j.length;r++){t=j[r];var o=i.getAttribute(k[t]);if(o){n[t]={};var p=JSON.parse(o);for(var q in l)if(p[q]!==undefined){n[t][q]=true;if(m[t]===undefined)m[t]={};if(m[t][q]===undefined)m[t][q]=[];if(l[q].length>0)m[t][q].push(l[q]);m[t][q].push('('+p[q]);}}}for(var r=0;r<i.childNodes.length;r++){var s=i.childNodes[r];g(s,j,k,l,m);}for(var t in n)for(var u in n[t]){var v=m[t][u][m[t][u].length-1];if(v.length>0&&v.charAt(0)=='('){m[t][u][m[t][u].length-1]=v.substr(1);}else m[t][u].push(')');}return m;}function h(i,j){var k={};for(var l=0;l<j.length;++l)k[j[l]]='data-'+j[l];var m={tn:"","tn-debug":","},n={};g(i,j,k,m,n);for(var o in n)for(var p in n[o])n[o][p]=n[o][p].join('');return n;}e.exports=h;});
__d("StreamViewportTracking",["Arbiter","DOM","NavigationMessage","Run","Style","UIIntentionalStreamMessage","Vector","$","collectSubtreeData","copyProperties","debounce","userAction"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('DOM'),i=b('NavigationMessage'),j=b('Run'),k=b('Style'),l=b('UIIntentionalStreamMessage'),m=b('Vector'),n=b('$'),o=b('collectSubtreeData'),p=b('copyProperties'),q=b('debounce'),r=b('userAction'),s=51,t='vpv';function u(){}p(u.prototype,{init:function(v){p(this,{timeout:900,readStoryIDs:{},minSizeToBeVisible:200,timeoutHandler:null,listeners:[],arbiterSubscriptions:[],recordTNTree:v});this.fireTimer();var w=q(this.fireTimer,this.timeout,this);this.listeners.push(Event.listen(window,'scroll',w));this.listeners.push(Event.listen(window,'resize',w));this.arbiterSubscriptions.push(g.subscribe(l.UPDATE_HTML_CONTENT,w));j.onLeave(this.cleanup.bind(this));this.arbiterSubscriptions.push(g.subscribe(i.NAVIGATION_BEGIN,this.cleanup.bind(this)));},cleanup:function(){this.listeners.forEach(function(v){v.remove();});this.listeners=[];this.arbiterSubscriptions.forEach(function(v){v.unsubscribe();});this.arbiterSubscriptions=[];clearTimeout(this.timeoutHandle);this.timeoutHandle=null;},fireTimer:function(){this.getStoriesInView().forEach(this.markStoryRead.bind(this));},getStoriesInView:function(){var v=h.scry(n('home_stream'),'.uiStreamStory'),w=[],x=false;for(var y=0;y<v.length;y++){var z=v[y],aa=this.getStoryID(z);if(this.hasBeenVisible(aa))continue;if(this.isVisible(z)){w.push(z);x=true;}else if(x)break;}return w;},hasBeenVisible:function(v){return v in this.readStoryIDs;},getStoryID:function(v){var w=JSON.parse(v.getAttribute('data-ft'));return w.mf_story_key;},isVisible:function(v){var w=m.getViewportDimensions(),x=m.getElementPosition(v,'viewport'),y=m.getElementDimensions(v),z=Math.max(x.y,0),aa=Math.min(x.y+y.y,w.y),ba=Math.min(y.y,this.minSizeToBeVisible);return (aa-z)>=ba;},markStoryRead:function(v){var w=this.getStoryID(v);if(!w)return;if(!this.hasBeenVisible(w)){this.readStoryIDs[w]=true;var x={evt:s};if(this.recordTNTree){var y=o(v,['ft']);for(var z in y.ft){x[z+'_tree']=y.ft[z];if(z==='tn-debug')v.setAttribute('tn-debug_subtree',y.ft[z]);}}r(t,v,null,'FORCE',{ft:x});}}});e.exports.init=function(v){(new u()).init(v);};});
PageletCache=window.PageletCache||{init:function(){try{PageletCache._cache=window.sessionStorage;}catch(a){}Arbiter.subscribe('pre_page_transition',PageletCache.cleanup);},_processBeforeWrite:function(a){Bootloader.setResourceMap(a.resource_map);var b=a.css||[];a.resource_map=a.resource_map||{};for(var c=0;c<b.length;c++){var d=b[c];if(!a.resource_map[d])a.resource_map[d]=Bootloader.resolveResources([d])[0];}delete a.js;delete a.bootloadable;delete a.onload;delete a.onafterload;delete a.jscc_map;delete a.jsmods;},write:function(a){if(!PageletCache._cache||a.cache_type=='base')return;var b={},c={};copy_properties(c,a);try{PageletCache._processBeforeWrite(c);b[a.key]=c;PageletCache._cache.setItem(a.id,JSON.stringify(b));PageletCache._pagelets[a.id]=c;}catch(d){}},loadFromCache:function(a){var b={};copy_properties(b,PageletCache.read(a.id,a.key));if(is_empty(b))return a;b.id=a.id;b.cache_hit=true;b.display_dependency=a.display_dependency;b.phase=a.phase;b.is_last=a.is_last;return b;},read:function(a,b){if(!PageletCache._cache)return null;if(a.substr(0,6)=='cached')a=a.substr(7);var c=PageletCache._cache.getItem(a);if(c){var d;try{d=JSON.parse(c);}catch(e){}if(d&&d[b]){PageletCache._pagelets[a]=d[b];PageletCache._cache_hits[a]=true;return d[b];}}},isCacheHit:function(a){return !!PageletCache._cache_hits[a];},cleanup:function(){PageletCache._cache_hits={};},_cache:null,_pagelets:{},_cache_hits:{}};
function PageletCacheController(a,b,c){if(!PageletCache)return;if(!a)return;this._cacheKey=a;this._cacheType=b;this._subscriptions=[];this._controller=null;this._registerSnapshot(c);PageletCacheController._instances[a]=this;PageletCache.takeSnapshot(a,null,this.handlePageletDOMOnSnapshot.bind(this));}copy_properties(PageletCacheController,{registerController:function(a,b){if(!a||!b)return null;var c=PageletCacheController._instances[a];if(c){c.setController(b);if(c._cacheType=='update'&&PageletCache.isCacheHit(a))onafterloadRegister_DEPRECATED(c.updateAfterload.bind(c,b));}return c;},_instances:{}});copy_properties(PageletCacheController.prototype,{registerCleanup:function(a){Arbiter.subscribe(a,this._cleanup.bind(this));},setController:function(a){this._controller=a;return this;},loadData:function(){return PageletCache.fetchData(this._cacheKey);},populateControllerDataOnSnapshot:bagofholding,handlePageletDOMOnSnapshot:bagofholding,updateAfterload:bagofholding,_registerSnapshot:function(a){for(var b=0;b<a.length;b++)this._subscriptions.push(Arbiter.subscribe(a[b],this._update.bind(this)));},_update:function(){if(!$(this._cacheKey)){this._cleanup();return;}var a=this._controller?this.populateControllerDataOnSnapshot.bind(this,this._controller):bagofholding;PageletCache.takeSnapshot(this._cacheKey,a,this.handlePageletDOMOnSnapshot.bind(this));},_cleanup:function(){this._subscriptions.forEach(Arbiter.unsubscribe);this._subscriptions.length=0;delete PageletCacheController._instances[this._cacheKey];}});copy_properties(PageletCache,{takeSnapshot:function(a,b,c){var d=PageletCache._pagelets[a];if(d){var e=$(a);if(e){var f=e.cloneNode(true);if(c)c(f);d.content[a]=f.innerHTML;if(b){if(!d.data)d.data={};b(d.data);}PageletCache.write(d);}}},fetchData:function(a,b){var c=PageletCache._pagelets[a];if(c&&c.data)if(b){return c.data[b];}else return c.data;}});
function HomeNavigationCache(a,b,c){this.parent.construct(this,a,b,c);}Class.extend(HomeNavigationCache,'PageletCacheController');copy_properties(HomeNavigationCache.prototype,{handlePageletDOMOnSnapshot:function(a){var b=DOM.scry(a,'li.sideNavItem');if(b.length===0)return;for(var c=0;c<b.length;c++){var d=b[c];if(d.id=='navItem_app_4748854339'){CSS.addClass(d,'selectedItem');}else if(CSS.hasClass(d,'selectedItem')){CSS.removeClass(d,'selectedItem');CSS.removeClass(d,'open');}CSS.removeClass(d,'loading');}var e=DOM.scry(a,'.uiFutureSideNav')[0];if(e)CSS.addClass(e,'hideNavCounts');}});
var NewHigh={reset:function(){this.initialized=false;},ensureInitialized:function(){if(this.initialized)return;this.button=DOM.scry(document.body,'a.stream_header_button')[0];this.composer=DOM.scry(document.body,'div.UIComposer')[0];this.buttonArea=DOM.scry(this.composer,'div.UIComposer_ButtonArea')[0];this.initialized=true;},showComposer:function(a){this.ensureInitialized();if(this.composer){CSS.show(this.composer);UIComposer.focusInstance(this.composer.id);var b=UIComposer.getInstance(this.composer.id);b&&b.loadAttachment(parseInt(a,10));}this.button&&CSS.hide(this.button);},hideComposer:function(a){this.ensureInitialized();if(this.composer){var b=UIComposer.getInstance(this.composer.id);if(!a){b&&b.initialized&&b.blur();CSS.hide(this.composer);this.button&&CSS.show(this.button);}else{b&&b.initialized&&b.loadAttachment(0);CSS.show(this.composer);this.buttonArea&&CSS.hide(this.buttonArea);}}}};
__d("UIIntentionalStreamMessage",[],function(a,b,c,d,e,f){var g={SET_AUTO_INSERT:'UIIntentionalStream/setAutoInsert',UPDATE_STREAM:'UIIntentionalStreamRefresh/updateStream',REFRESH_STREAM:'UIIntentionalStreamRefresh/refreshStream',UPDATE_AUTOREFRESH_CONFIG:'UIIntentionalStream/updateAutoRefreshConfig',UPDATE_HTML_CONTENT:'UIIntentionalStream/updateHtmlContent',UPDATE_LAST_REFRESH_TIME:'UIIntentionalStream/updateLastRefreshTime',INSERT_STORIES:'UIIntentionalStream/updateLastRefreshTime'};e.exports=g;});
__d("legacy:UIIntentionalStream-message",["UIIntentionalStreamMessage"],function(a,b,c,d){a.UIIntentionalStreamMessage=b('UIIntentionalStreamMessage');},3);
function UIIntentionalStream(a,b,c,d,e,f,g,h,i,j,k){if(!a)throw new Error('UIIntentionalStream instantiated with no root.');copy_properties(this,{id:a.id,root:a,instanceName:b,newest:c,oldest:d,oldestMR:d,shouldShowHidden:false,defaultFilter:e,currentFilterKey:j,sourceType:f,lastSeenTime:k,hasPendingRefresh:false,pauseAutoInsert:false,error:DOM.scry(a,'div.UIIntentionalStream_Error')[0],pager:DOM.scry(a,'div.uiMorePager')[0],filterNullState:DOM.scry(a,'div.friendListFilterNullState')[0],streamContent:DOM.find(a,'.UIIntentionalStream_Content'),requestNum:0,scrollLoadCount:1,maxScrollLoadCount:1,lastViewStateID:0,jslog:JSLogger.create('stream')});this.addScrollTrace('init',{});onleaveRegister(this.unload.bind(this));if(!UIIntentionalStream.instances)UIIntentionalStream.instances={};UIIntentionalStream.instances[b]=this;UIIntentionalStream.instance=this;this.setupAutoInsert();this.setupSubscriptions();}UIIntentionalStream.isHighlightsFilter=function(a){if(!a)return false;var b=startsWith(a,UIIntentionalStream.FEED_FILTER_KEY_NEW_HIGHLIGHTS);return b;};UIIntentionalStream.prototype.subscribeToComposerPublish=function(){this.subscriptions.push(Arbiter.subscribe('composer/publish',function(event,a){if(a.streamStory)this.addComposerContent(a.streamStory,500);}.bind(this)));};UIIntentionalStream.prototype.setupSubscriptions=function(){this.subscriptions=[];this.subscribeToComposerPublish();this.subscriptions.push(Arbiter.subscribe(UIIntentionalStreamMessage.UPDATE_STREAM,this.updateStream.bind(this)));this.subscriptions.push(Arbiter.subscribe(UIIntentionalStreamMessage.REFRESH_STREAM,this.refreshStream.bind(this)));};UIIntentionalStream.prototype.tearDownSubscriptions=function(){if(!this.subscriptions)return;this.subscriptions.forEach(Arbiter.unsubscribe);this.subscriptions=null;};UIIntentionalStream.prototype.unload=function(){this.addScrollTrace('unload',{});this.tearDownSubscriptions();UIIntentionalStream.instance=null;UIIntentionalStream.instances[this.instanceName]=null;this.clearScrollLoader(true);window.disableScrollLoad=null;UIIntentionalStreamRefresh.instance&&UIIntentionalStreamRefresh.instance.unload();};UIIntentionalStream.getInstance=function(a){return UIIntentionalStream.instances[a];};UIIntentionalStream.prototype._getUpdateInsertType=function(){return UIIntentionalStream.REFRESH_PREPEND;};UIIntentionalStream.prototype.updateStream=function(a){if(a!=UIIntentionalStreamMessage.UPDATE_STREAM||this.hasPendingRefresh||this.isAutoRefreshPaused())return;this.loadNewer({showLoader:false,ignoreSelf:true,insertType:this._getUpdateInsertType()});};UIIntentionalStream.prototype.clearScrollLoader=function(a){if(this.currentScrollListener){this.currentScrollListener.remove();this.currentScrollListener=null;}if(a||this.scrollLoadCount>=this.maxScrollLoadCount)window.disableScrollLoad=true;};UIIntentionalStream.prototype.loadOlderPosts=function(a){var b={filter:this.getCurrentFilterKey(),oldest:this.oldest,oldestMR:this.oldestMR,last_seen_time:this.lastSeenTime,scroll_count:this.scrollLoadCount,scroll_position:this.scrollPosition,last_viewstate_id:this.lastViewStateID};b=merge(b,a);this.loadWithParams(b);};UIIntentionalStream.prototype.loadWithParams=function(a){var b=DOM.scry(this.root,'div.fbStreamPager.hasMorePosts')[0];if(b){if(CSS.hasClass(b,'async_saving'))return;CSS.addClass(b,'async_saving');}this.addScrollTrace('loadwithparams',a);UIPagelet.loadFromEndpoint('MoreStoriesPagelet','home_stream',a,{usePipe:true,append:true});};UIIntentionalStream.prototype.setScrollLoadCount=function(a){this.maxScrollLoadCount=a;};UIIntentionalStream.prototype.loadMoreOnScroll=function(a,b){if(window.disableScrollLoad)return;var c=function(){if(window.disableScrollLoad)return;if(window.ArbiterMonitor){var f=user_action('scroll',null,null,'FORCE',{gt:{ua_id:'stream:scroll:auto'}});f.set_namespace('stream');ArbiterMonitor.initUA(f);}var g={delay_load_count:b};this.loadOlderPosts(g);}.bind(this),d=DOM.scry(this.root,'ul.uiStream li.genericStreamStory');if(!d.length)return;this.addScrollTrace('loadmoreonscroll',{});var e=d[d.length-a-1];if(e){this.currentScrollListener=new OnVisible(e,c,null,0);}else c();};UIIntentionalStream.prototype.updateTimeRange=function(a,b){if(!this.newest||this.newest<a){this.newest=a;this.addScrollTrace('update_newest',{newest:this.newest});}if(!this.oldest||(b&&(b<this.oldest))){this.oldest=b;this.addScrollTrace('update_oldest',{oldest:this.oldest});}};UIIntentionalStream.prototype.updateOldestMR=function(a){if(!this.oldestMR||a<this.oldestMR){this.oldestMR=a;this.addScrollTrace('update_oldestmr',{oldestmr:this.oldestMR});}};UIIntentionalStream.prototype.updateScrollPosition=function(a){this.scrollPosition=a;this.addScrollTrace('update_scrollposition',{scrollposition:this.scrollPosition});};UIIntentionalStream.prototype.updateLastViewStateID=function(a){this.lastViewStateID=a;this.addScrollTrace('update_lastviewstateid',{lastviewstateid:this.lastViewStateID});};UIIntentionalStream.prototype.getID=function(){return this.id;};UIIntentionalStream.prototype.getCurrentFilterKey=function(){if(this.currentFilterKey)return this.currentFilterKey;var a=URI.getMostRecentURI().getQueryData();if(a&&a.sk){this.currentFilterKey=a.sk;}else if(a&&a.filter){this.currentFilterKey=a.filter;}else if(this.defaultFilter)this.currentFilterKey=this.defaultFilter;return this.currentFilterKey;};UIIntentionalStream.prototype.resetFilterKey=function(a){this.currentFilterKey=a;};UIIntentionalStream.prototype.loadOlder=function(a){a=a||{};if(!this.oldest)return;var b=this.getCurrentParams();b.oldest=this.oldest;this.refresh(UIIntentionalStream.REFRESH_APPEND,b,a);return this;};UIIntentionalStream.prototype.loadNewer=function(a){if(!this.newest)return;a=a||{};var b=this.getCurrentParams();b.newest=this.newest;if(a.ignoreSelf)b.ignore_self=true;b.load_newer=true;var c=coalesce(a.insertType,UIIntentionalStream.REFRESH_PREPEND);this.refresh(c,b,a);return this;};UIIntentionalStream.prototype.getCurrentParams=function(){var a={},b=URI.getMostRecentURI().getQueryData();b.filter=this.getCurrentFilterKey();var c=this.getValidParams();if(c){c.forEach(function(d){a[d]=b[d];});}else a=b;return a;};UIIntentionalStream.prototype.setHomeFilter=function(a){this._homeFilter=a;};UIIntentionalStream.prototype.setHomeFilterLoading=function(a){if(this._homeFilter)this._homeFilter.setLoading(a);};UIIntentionalStream.prototype.refresh=function(a,b,c){Arbiter.inform(UIIntentionalStreamMessage.UPDATE_LAST_REFRESH_TIME);this.addScrollTrace('refresh',{type:a,data:b,kwargs:c});this.currentFilterKey=b.filter;if(b.filter==UIIntentionalStream.FEED_FILTER_KEY_DUAL_NEWS_FEED){this.currentFilterKey=this.defaultFilter;}else if(UIIntentionalStream.isHighlightsFilter(b.filter)||b.filter===UIIntentionalStream.FEED_FILTER_KEY_NEWS_FEED)this.defaultFilter=this.currentFilterKey;c=c||{};var d=++this.requestNum,e=coalesce(c.showLoader,true),f=this.instanceName,g=function(k){UIIntentionalStream.getInstance(f).handleResponse(d,a,k,c);},h=function(k){UIIntentionalStream.getInstance(f).handleError(d,a,k,c);},i=function(k){UIIntentionalStream.getInstance(f).handleFinally(a,b.filter,k);};if(!(b.request_type=a))b.request_type='none';if(b.filter){c.show_hidden=b.show_hidden?b.show_hidden:false;}else c.show_hidden=this.shouldShowHidden;b=copy_properties(this.getCurrentParams(),b);this.hasPendingRefresh=true;var j;if(a==UIIntentionalStream.REFRESH_APPEND&&e)j=this.pager;new AsyncRequest().setURI(this.getEndpoint()).setReadOnly(true).setOption('retries',0).setMethod(this.getRefreshMethod()).setData(b).setHandler(g).setStatusElement(j).setErrorHandler(h).setFinallyHandler(i).send();if(a==UIIntentionalStream.REFRESH_TRANSITION){hide(this.pager);this.clearScrollLoader();this.oldest=this.newest=null;}if(e)this.setHomeFilterLoading(true);};UIIntentionalStream.prototype.addComposerContent=function(a,b){if(this.isOnNewsFeedFilter())CSS.addClass(a,'uiStreamBoulderHighlight');this.addContentPrepend(a,b);};UIIntentionalStream.prototype.addContentPrepend=function(a,b){if(a.length){$A(a).reverse().forEach(function(h){this.addContentPrepend(h,b);}.bind(this));return;}var c,d=Vector2.getScrollPosition().y,e=Vector2.getElementPosition(this.streamContent).y,f=this.scrollOnPrepend&&d>=e;if(f){var g=function(h){var i=DOM.find(h,'^li.uiStreamStory');if(!i)return;DataStore.set(i,'origHeight',i.offsetHeight);Event.listen(h,'load',function(){var j=DataStore.get(i,'origHeight');if(i.offsetHeight!=j){window.scrollBy(0,i.offsetHeight-j);DataStore.set(i,'origHeight',i.offsetHeight);}});};c=animation.insert.curry(this.streamContent,a,(function(h,i){DOM.prependContent(this.streamContent,i);Arbiter.inform('reflow');window.scrollBy(0,i.offsetHeight);DOM.scry(i,'img').forEach(g);}).bind(this));}else c=(function(){CSS.setStyle(a,'opacity',0);ScrollAwareDOM.prependContent(this.streamContent,a);Arbiter.inform('reflow');animation(a).from('opacity',0).to('opacity',1).duration(400).go();}).bind(this);if(b){CSS.hide(a);DOM.appendContent(document.body,a);setTimeout(function(){CSS.show(a);c();},b);}else c();};UIIntentionalStream.prototype.addContentAppend=function(a){DOM.appendContent(this.streamContent,a);};UIIntentionalStream.getStoriesByAssoc=function(a){return DOM.scry(UIIntentionalStream.instance.root,'div.aid_'+a);};UIIntentionalStream.prototype.handleResponse=function(a,b,c,d){this.addScrollTrace('handle_response',{requestnum:a,type:b,kwargs:d});d=d||{};var e=c.getPayload();this.filterNullState&&DOM.remove(this.filterNullState);if(is_empty(e))return;if(e.autoRefreshConfig)Arbiter.inform(UIIntentionalStreamMessage.UPDATE_AUTOREFRESH_CONFIG,e.autoRefreshConfig);this.setHomeFilterLoading(false);if(b==UIIntentionalStream.REFRESH_EXPAND){var f=DOM.find($(d.expandStoryID),'div.UIIntentionalStory_CollapsedStories');CSS.hide(f);CSS.removeClass(f,'UIIntentionalStory_CollapsedStoriesLoading');}if(this.error)hide(this.error);if(a!=this.requestNum)return;if('show_hidden' in d)this.shouldShowHidden=d.show_hidden;if('newestStoryTime' in e&&e.newestStoryTime>this.newest)this.newest=e.newestStoryTime;if(b!=UIIntentionalStream.REFRESH_PREPEND){if('oldestStoryTime' in e&&(!this.oldest||e.oldestStoryTime<this.oldest))this.oldest=e.oldestStoryTime;if('scrollPosition' in e)this.scrollPosition=e.scrollPosition;if('lastViewStateID' in e)this.lastViewStateID=e.lastViewStateID;if('oldestMRStoryTime' in e)this.oldestMR=e.oldestMRStoryTime;}if(e.html){var g=HTML(e.html).getNodes();switch(b){case UIIntentionalStream.REFRESH_PREPEND:this.addContentPrepend(g);break;case UIIntentionalStream.REFRESH_APPEND:this.addContentAppend(g);this.clearScrollLoader(true);break;case UIIntentionalStream.REFRESH_TRANSITION:DOM.setContent(this.streamContent,g);var h=this.streamContent.firstChild;if(!d.noScroll)DOMScroll.scrollTo(new Vector2(0,0,"document"),false);break;case UIIntentionalStream.REFRESH_EXPAND:DOM.insertAfter($(d.expandStoryID),g);break;case UIIntentionalStream.DELAYED_STREAM:this.addContentAppend(g);break;}Arbiter.inform(UIIntentionalStreamMessage.UPDATE_HTML_CONTENT);}};UIIntentionalStream.prototype.handleError=function(a,b,c,d){if(a!=this.requestNum)return;this.setHomeFilterLoading(false);var e=c.getError();if(e==1357001)AsyncResponse.defaultErrorHandler(c);if(b==UIIntentionalStream.REFRESH_EXPAND){var f=DOM.find($(d.expandStoryID),'div.UIIntentionalStory_CollapsedStories');CSS.removeClass(f,'UIIntentionalStory_CollapsedStoriesLoading');}if(!d.delayLoadCount&&b!=UIIntentionalStream.REFRESH_PREPEND&&this.error)CSS.setStyle(this.error,'display','block');};UIIntentionalStream.prototype.handleFinally=function(a,b){if(a==UIIntentionalStream.REFRESH_TRANSITION){PageTransitions.transitionComplete();Arbiter.inform(NavigationMessage.NAVIGATION_COMPLETED);}this.hasPendingRefresh=false;};UIIntentionalStream.prototype.getValidParams=function(){return UIIntentionalStream.VALID_PARAMS;};UIIntentionalStream.prototype.getEndpoint=function(){return UIIntentionalStream.ENDPOINT;};UIIntentionalStream.prototype.getRefreshMethod=function(){return UIIntentionalStream.REFRESH_METHOD;};UIIntentionalStream.prototype.isOnNewHighlights=function(){var a=this.getCurrentFilterKey();return (UIIntentionalStream.isHighlightsFilter(a)||(a==UIIntentionalStream.FEED_FILTER_KEY_DUAL_NEWS_FEED&&UIIntentionalStream.isHighlightsFilter(this.defaultFilter)));};UIIntentionalStream.prototype.isLiveStreamBox=function(){var a=this.getCurrentFilterKey();return a&&a.indexOf(UIIntentionalStream.FEED_FILTER_KEY_LIVE_STREAM_BOX)==0;};UIIntentionalStream.prototype.isOnNewsFeedFilter=function(){var a=this.getCurrentFilterKey();return (a==UIIntentionalStream.FEED_FILTER_KEY_NEWS_FEED||UIIntentionalStream.isHighlightsFilter(a)||a==UIIntentionalStream.FEED_FILTER_KEY_DUAL_NEWS_FEED);};UIIntentionalStream.prototype.setupAutoInsert=function(){Arbiter.subscribe(UIIntentionalStreamMessage.SET_AUTO_INSERT,UIIntentionalStream.setAutoInsert);};UIIntentionalStream.setAutoInsert=function(a,b){if(a!=UIIntentionalStreamMessage.SET_AUTO_INSERT)return;var c=UIIntentionalStream.instance;if(c)c.pauseAutoInsert=b.pause;};UIIntentionalStream.prototype.isAutoRefreshPaused=function(){if(this.isOnNewHighlights()||this.isLiveStreamBox())return false;return this.pauseAutoInsert;};UIIntentionalStream.prototype.addScrollTrace=function(a,b){this.jslog.debug(a,b);};UIIntentionalStream.prototype.refreshStream=function(a,b){if(a!=UIIntentionalStreamMessage.REFRESH_STREAM)return;var c=this.getCurrentFilterKey(),d={filter:c},e={filter:c};b.noScroll&&(e.noScroll=1);this.refresh(UIIntentionalStream.REFRESH_TRANSITION,d,e);};copy_properties(UIIntentionalStream,{ANIMATION_DURATION:300,REFRESH_METHOD:'GET',REFRESH_TRANSITION:1,REFRESH_PREPEND:2,REFRESH_APPEND:3,REFRESH_EXPAND:5,DELAYED_STREAM:6,FEED_FILTER_KEY_NEW_HIGHLIGHTS:'h',FEED_FILTER_KEY_NEWS_FEED:'lf',FEED_FILTER_KEY_DUAL_NEWS_FEED:'nf',FEED_FILTER_KEY_LIVE_STREAM_BOX:'pub',VALID_PARAMS:['filter','show_hidden'],ENDPOINT:'/ajax/intent.php'});
function FutureHomeSideNav(){this.parent.construct(this);}Class.extend(FutureHomeSideNav,'FutureSideNav');copy_properties(FutureHomeSideNav.prototype,{init:function(){this.parent.init.apply(this,arguments);this.ajaxPipe=true;this.seeAllEndpoint="/ajax/home/generic.php";this.typeSections={favorites:'pinnedNav',profiles:'pinnedNav',apps:'appsNav',groups:'groupsNav',pages:'pagesNav',lists:'listsNav',interests:'interestsNav',connect_apps:'connectNav'};this.switchingFromTitanFixedFrame=false;this._arbiterSubscriptions.push(Arbiter.subscribe('titan_fixed_frame_changed',this.handleFixedFrameChanged.bind(this)),Arbiter.subscribe(NavigationMessage.NAVIGATION_FAVORITE_UPDATE,this.updateFavorite.bind(this)),Arbiter.subscribe(NavigationMessage.NAVIGATION_FIRST_RESPONSE,this.navigationFirstResponse.bind(this)));this._ensureHover('homeSideNav');this._initPageletCache();},_initPageletCache:function(a){if(window.PageletCacheController){this._cache=PageletCacheController.registerController('pagelet_navigation',this);if(this._cache){this._cache.registerCleanup('HomeNav/cleanup');onleaveRegister(function(){Arbiter.inform('HomeNav/cleanup');});}}},initMoreLink:function(a){this._eventHandlers.push(Event.listen(a,'click',this._showMoreSections.bind(this,a)));},_showMoreSections:function(a){var b=DOM.scry(this.root,'div.belowThreshold');CSS.hide(a);b.forEach(function(c){CSS.removeClass(c,'belowThreshold');});},handleFixedFrameChanged:function(a,b,c){if(b){var d=function(e,f){UIPagelet.loadFromEndpoint(e,f,{fixed_frame:b,selected_key:c});};d('PinnedNavigationPagelet','pagelet_pinned_nav');d('BookmarkNavigationPagelet','pagelet_bookmark_nav');if(ge('chatFriendsOnline'))CSS.hide(ge('chatFriendsOnline'));}else this.switchingFromTitanFixedFrame=true;},handlePageTransition:function(a){if(this.switchingFromTitanFixedFrame){this.switchingFromTitanFixedFrame=false;return false;}else return this.parent.handlePageTransition(a);},_initSection:function(a){var b=this.parent._initSection(a);for(var c in this.typeSections){var d=this.typeSections[c];if(b.id==d){var e=DOM.scry(b.node,'div.navHeader')[0];if(e){var f='\/bookmarks\/('+c+')(\/)?';b.seeall=this._initItem({node:e,id:b.id,endpoint:this.seeAllEndpoint,key:['bookmarks'],path:[{regex:f}]});}}}return b;},_constructItem:function(a,b){return new FutureHomeSideNavItem(a,b);},_constructSection:function(a){return new FutureHomeSideNavSection(a);},getSection:function(a){return this.typeSections[a]&&this.sections[this.typeSections[a]];},_getItemForKey:function(a){var b=this.parent._getItemForKey("nf");if(b&&b.matchKey(a)){return b;}else return this.parent._getItemForKey(a);},_isCurrentPath:function(a){return ((a.getDomain()===this.uri.getDomain())&&(a.getPath()==='/'||a.getPath()==='/home.php'));},_handleMenuClick:function(a,b,c,event){if(CSS.hasClass(c,'favorite')){Arbiter.inform(NavigationMessage.NAVIGATION_FAVORITE_UPDATE,{key:b.numericKey,favorite:!a.equals(this.getSection("favorites")),movetop:CSS.hasClass(c,'movetop')});}else this.parent._handleMenuClick(a,b,c,event);},removeItemByKey:function(a){Arbiter.inform(NavigationMessage.NAVIGATION_ITEM_REMOVED,a);this.parent.removeItemByKey(a);},toggleItemByKey:function(a,b){var c=this.getNodeForKey(a);if(!b){Arbiter.inform(NavigationMessage.NAVIGATION_ITEM_HIDDEN,a);c&&CSS.hide(c);}else c&&CSS.show(c);var d=this._getItemForKey(a);this.getSection(d.type).refresh();},removeItem:function(a){var b=this.getSection(a.type);this.parent.removeItem(a);b.refresh();},updateFavorite:function(a,b){var c=this._findItem(function(l){return l.matchKey(b.key)&&l.canFavorite();}),d=this.getSection("favorites"),e=bagofholding,f=b.favorite?d.addEndpoint:d.removeEndpoint;if(b.movetop)f=d.editEndpoint;if(!c&&(b.favorite||b.movetop)){if(b.movetop)var g=DOM.scry(this.root,'.expandableSideNav'),h=g&&g.length&&CSS.hasClass(g[0],'expandedMode');e=function(){UIPagelet.loadFromEndpoint('PinnedNavigationPagelet','pagelet_pinned_nav',{expanded:h});};}else if(!c){e=function(){UIPagelet.loadFromEndpoint('BookmarkNavigationPagelet','pagelet_bookmark_nav');};}else{if(b.movetop){CSS.show(c.node);this.moveItem(d,c);var i=Parent.byClass(c.node,'uiSideNav');if(i&&i.childNodes.length){var j=Parent.byClass(DOM.scry(i,'.sortableItem')[0],'sideNavItem');DOM.insertBefore(j,c.node);CSS.removeClass(c.node,'hidden');}}else{var k=this.getSection(c.type);if(b.favorite){CSS.show(c.node);this.moveItem(d,c);c.showFavorite();}else if(!k.equals(d)){this.moveItem(k,c);c.hideFavorite();}else this.removeItem(c);k.refresh();}d.refresh();b.key=c.numericKey;Arbiter.inform('NavigationMessage.FAVORITES_UPDATED');}new AsyncRequest().setURI(f).setData({id:b.key,movetop:b.movetop}).setHandler(e).send();},_doPageTransition:function(a,b){this._unloadStreams();var c=this.parent._doPageTransition(a,b);if(c&&(a.type=='groups'||a.type=='lists'||a.type=='interests')){a.setCount(0);a.hideUnreadDot();}return c;},_unloadStreams:function(){var a=window.UIIntentionalStream&&UIIntentionalStream.instances,b=['nile','global','friends','blade'];a&&b.forEach(function(c){a[c]&&a[c].unload();});},navigationFirstResponse:function(){this.setSelected(this.loading);}});function FutureHomeSideNavSection(a){this.parent.construct(this,a);this.editEndpoint='/ajax/bookmark/edit/';this.addEndpoint='/ajax/bookmark/add/';this.removeEndpoint='/ajax/bookmark/delete/';}Class.extend(FutureHomeSideNavSection,'FutureSideNavSection');copy_properties(FutureHomeSideNavSection.prototype,{refresh:function(){var a=DOM.scry(this.node,'li.sideNavItem'),b=DOM.scry(this.node,'div.actionLinks'),c=a.some(CSS.shown);CSS.conditionShow(DOM.find(this.node,'div.navHeader'),c);b.length&&CSS.conditionShow(b[0],c);}});function FutureHomeSideNavItem(a,b){this.parent.construct(this,a,b);}Class.extend(FutureHomeSideNavItem,'FutureSideNavItem');copy_properties(FutureHomeSideNavItem.prototype,{canFavorite:function(){return !!this._getFavoriteLabel();},showFavorite:function(){DOM.setContent(this._getFavoriteLabel(),"Remove from Favorites");},hideFavorite:function(){DOM.setContent(this._getFavoriteLabel(),"Add to Favorites");},hideUnreadDot:function(){var a=DOM.scry(this.node,'img.unreadDot')[0];a&&CSS.hide(a);},_getFavoriteLabel:function(){return DOM.scry(this.node,'li.favorite span.itemLabel')[0];}});
__d("legacy:ad-logging",["Arbiter","AsyncRequest","collectDataAttributes"],function(a,b,c,d){var e=b('Arbiter'),f=b('AsyncRequest'),g=b('collectDataAttributes'),h={};function i(l){return (l.getAttribute&&(l.getAttribute('ajaxify')||l.getAttribute('data-endpoint'))||l.action||l.href||l.name);}function j(l,m){if(m.doublelog&&typeof(m.ei)==="string"){new f('/ajax/ssinfeed/end/').setData({doublelog:true,ei:m.ei}).setAllowCrossPageTransition(true).setMethod('POST').send();}else if(l!==null&&typeof(l.ei)==="string"){var n=Date.now(),o=500;l.duplicate_click=!!h[l.ei]&&(n-h[l.ei]<o);h[l.ei]=n;new f('/ajax/ssinfeed/end/').setData(l).setAllowCrossPageTransition(true).setMethod('POST').send();}}function k(l,m){if(!m.node)return;var n=i(m.node);if(!n||!m.event||m.event.type!=='click')return;var o=g(m.node,['ft','ad']);o.ft.href=n;j(o.ft,o.ad);}e.subscribe("UserAction/new",k);},3);
function HomeAdFirstRightColumnController(){}copy_properties(HomeAdFirstRightColumnController.prototype,{init:function(a){copy_properties(this,{_enableSidebar:a.enableSidebar,_tickerHeightOffset:200,contentCol:$('contentCol'),blueBar:$('blueBar'),_tickerMaxHeight:(a.tickerMaxHeight||500),_listeners:[],_subscriptions:[]});this._topOffset=0;this.PADDING_TICKER_TO_TOP=5;this.PADDING_RHC_TO_BOTTOM=60;this._sidebarIsHidden=true;this._listeners.push(Event.listen(window,'resize',this.handleResize.bind(this)));this._blueBarHeight=Vector2.getElementDimensions(this.blueBar).y;this.reloadRightCol();this._initSubscriptions();onunloadRegister(this.cleanup.bind(this));this._listeners.push(Event.listen(window,'scroll',this._handleScroll.bind(this)));if(!CSS.hasClass(document.documentElement,'sidebarMode')){this._onSidebarHide();}else if(this._enableSidebar)this._onSidebarShow();this.handleResize();},_initSubscriptions:function(){this._subscriptions=[Arbiter.subscribe('Ticker/storiesInserted',this.handleResize.bind(this)),Arbiter.subscribe('concierge/load',this.handleResize.bind(this)),Arbiter.subscribe(UIIntentionalStreamMessage.INSERT_STORIES,this.handleResize.bind(this))];if(this._enableSidebar){this._subscriptions.push(Arbiter.subscribe('sidebar/hide',this._onSidebarHide.bind(this)));this._subscriptions.push(Arbiter.subscribe('sidebar/show',this._onSidebarShow.bind(this)));}},_onNavHandler:function(a,b){var c=b.params.key;if(c!='lf'&&c!='h')this.cleanup();},reloadRightCol:function(){this.fixedScrollingContainer=ge('fixed_scrolling_container');this.fixedScrollingWrapper=DOM.scry(this.fixedScrollingContainer,'.fixed_scrolling_wrapper')[0];this.tickerPagelet=ge('pagelet_rhc_ticker');if(!this.tickerPagelet)return false;this.tickerContainer=DOM.scry(this.tickerPagelet,'.ticker_container')[0];this.tickerStream=DOM.scry(this.tickerPagelet,'.ticker_stream')[0];return this.tickerContainer&&this.tickerStream;},cleanup:function(){this._subscriptions.forEach(Arbiter.unsubscribe);this._subscriptions=[];this._listeners.forEach(function(a){a.remove();});this._listeners=[];},_handleScroll:function(){if(!this._sidebarIsHidden||!this.tickerStream)return;this._topOffset=this.PADDING_TICKER_TO_TOP+this._blueBarHeight;var a=CSS.hasClass(document.documentElement,'tinyViewport'),b=!a;if(b){var c=Vector2.getElementPosition(this.fixedScrollingContainer,'viewport');if(!c||c.y>=this._topOffset)b=false;}if(b!==CSS.hasClass(this.fixedScrollingWrapper,'fixed_elem'))this._setFixedRightCol(b);},_setFixedRightCol:function(a){var b=a?this._topOffset+'px':'';CSS.setStyle(this.fixedScrollingWrapper,'top',b);CSS.conditionClass(this.fixedScrollingWrapper,'fixed_elem',a);var c=a?'Ticker/fixed':'Ticker/unfixed';Arbiter.inform(c);},handleResize:function(){if(!this._sidebarIsHidden||!this.tickerStream||CSS.hasClass(document.documentElement,'tinyViewport'))return;this._handleScroll();var a=Vector2.getViewportDimensions().y,b=Vector2.getElementDimensions(this.fixedScrollingWrapper).y-Vector2.getElementDimensions(this.tickerContainer).y,c=a-this._topOffset-b-this.PADDING_RHC_TO_BOTTOM,d=Vector2.getElementDimensions(this.tickerStream).y,e=Math.min(c,d,this._tickerMaxHeight);CSS.setStyle(this.tickerContainer,'height',e+'px');},_onSidebarHide:function(){this._sidebarIsHidden=true;this.reloadRightCol();var a=function(){if(this.reloadRightCol())this.handleResize();};this.tickerPagelet&&TickerController.show(this.tickerPagelet,a.bind(this));},_onSidebarShow:function(){this._sidebarIsHidden=false;this.reloadRightCol();this._setFixedRightCol(false);this.tickerPagelet&&TickerController.hide(this.tickerPagelet);}});